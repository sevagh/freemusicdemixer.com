let SAMPLE_RATE=44100,wasmModule,modelName,modelBuffers;function loadWASMModule(e){try{importScripts(e),wasmModule=libdemucs()}catch(e){console.error("Error loading WASM module script:",e)}}function processAudio(t,o,E,n){var m=E._malloc(t.length*t.BYTES_PER_ELEMENT),_=(new Float32Array(E.HEAPF32.buffer,m,t.length).set(t),E._malloc(o.length*o.BYTES_PER_ELEMENT));if(new Float32Array(E.HEAPF32.buffer,_,o.length).set(o),"demucs-free-4s"===modelName||"demucs-free-v3"===modelName||"demucs-pro-ft"===modelName||"demucs-pro-deluxe"===modelName)return o=E._malloc(t.length*t.BYTES_PER_ELEMENT),A=E._malloc(t.length*t.BYTES_PER_ELEMENT),d=E._malloc(t.length*t.BYTES_PER_ELEMENT),u=E._malloc(t.length*t.BYTES_PER_ELEMENT),f=E._malloc(t.length*t.BYTES_PER_ELEMENT),F=E._malloc(t.length*t.BYTES_PER_ELEMENT),g=E._malloc(t.length*t.BYTES_PER_ELEMENT),s=E._malloc(t.length*t.BYTES_PER_ELEMENT),E._modelDemixSegment(m,_,t.length,A,F,o,f,d,g,u,s,null,null,null,null,null,null,n),h=new Float32Array(E.HEAPF32.buffer,o,t.length),c=new Float32Array(E.HEAPF32.buffer,A,t.length),P=new Float32Array(E.HEAPF32.buffer,d,t.length),N=new Float32Array(E.HEAPF32.buffer,u,t.length),y=new Float32Array(E.HEAPF32.buffer,f,t.length),w=new Float32Array(E.HEAPF32.buffer,F,t.length),T=new Float32Array(E.HEAPF32.buffer,g,t.length),S=new Float32Array(E.HEAPF32.buffer,s,t.length),E._free(m),E._free(_),E._free(o),E._free(f),E._free(A),E._free(F),E._free(d),E._free(g),E._free(u),E._free(s),[new Float32Array(h),new Float32Array(y),new Float32Array(c),new Float32Array(w),new Float32Array(P),new Float32Array(T),new Float32Array(N),new Float32Array(S)];if("demucs-free-6s"===modelName||"demucs-pro-cust"===modelName){var o=E._malloc(t.length*t.BYTES_PER_ELEMENT),f=E._malloc(t.length*t.BYTES_PER_ELEMENT),A=E._malloc(t.length*t.BYTES_PER_ELEMENT),F=E._malloc(t.length*t.BYTES_PER_ELEMENT),d=E._malloc(t.length*t.BYTES_PER_ELEMENT),g=E._malloc(t.length*t.BYTES_PER_ELEMENT),u=E._malloc(t.length*t.BYTES_PER_ELEMENT),s=E._malloc(t.length*t.BYTES_PER_ELEMENT),h=E._malloc(t.length*t.BYTES_PER_ELEMENT),y=E._malloc(t.length*t.BYTES_PER_ELEMENT),c=E._malloc(t.length*t.BYTES_PER_ELEMENT),w=E._malloc(t.length*t.BYTES_PER_ELEMENT);let e=null,l=null;"demucs-pro-cust"===modelName&&(e=E._malloc(t.length*t.BYTES_PER_ELEMENT),l=E._malloc(t.length*t.BYTES_PER_ELEMENT)),E._modelDemixSegment(m,_,t.length,f,g,o,d,A,u,F,s,h,y,c,w,e,l,n);var P=new Float32Array(E.HEAPF32.buffer,o,t.length),T=new Float32Array(E.HEAPF32.buffer,f,t.length),N=new Float32Array(E.HEAPF32.buffer,A,t.length),S=new Float32Array(E.HEAPF32.buffer,F,t.length),L=new Float32Array(E.HEAPF32.buffer,d,t.length),M=new Float32Array(E.HEAPF32.buffer,g,t.length),b=new Float32Array(E.HEAPF32.buffer,u,t.length),R=new Float32Array(E.HEAPF32.buffer,s,t.length),i=new Float32Array(E.HEAPF32.buffer,h,t.length),B=new Float32Array(E.HEAPF32.buffer,y,t.length),H=new Float32Array(E.HEAPF32.buffer,c,t.length),Y=new Float32Array(E.HEAPF32.buffer,w,t.length);let r=null,a=null;return"demucs-pro-cust"===modelName&&(r=new Float32Array(E.HEAPF32.buffer,e,t.length),a=new Float32Array(E.HEAPF32.buffer,l,t.length)),E._free(m),E._free(_),E._free(o),E._free(d),E._free(f),E._free(g),E._free(A),E._free(u),E._free(F),E._free(s),E._free(h),E._free(y),E._free(c),E._free(w),"demucs-pro-cust"===modelName&&(E._free(e),E._free(l)),"demucs-free-6s"===modelName?[new Float32Array(P),new Float32Array(L),new Float32Array(T),new Float32Array(M),new Float32Array(N),new Float32Array(b),new Float32Array(S),new Float32Array(R),new Float32Array(i),new Float32Array(B),new Float32Array(H),new Float32Array(Y)]:"demucs-pro-cust"===modelName?[new Float32Array(P),new Float32Array(L),new Float32Array(T),new Float32Array(M),new Float32Array(N),new Float32Array(b),new Float32Array(S),new Float32Array(R),new Float32Array(i),new Float32Array(B),new Float32Array(H),new Float32Array(Y),new Float32Array(r),new Float32Array(a)]:void 0}if("demucs-karaoke"===modelName)return o=E._malloc(t.length*t.BYTES_PER_ELEMENT),d=E._malloc(t.length*t.BYTES_PER_ELEMENT),f=E._malloc(t.length*t.BYTES_PER_ELEMENT),g=E._malloc(t.length*t.BYTES_PER_ELEMENT),E._modelDemixSegment(m,_,t.length,o,f,d,g,n),A=new Float32Array(E.HEAPF32.buffer,o,t.length),u=new Float32Array(E.HEAPF32.buffer,d,t.length),F=new Float32Array(E.HEAPF32.buffer,f,t.length),s=new Float32Array(E.HEAPF32.buffer,g,t.length),E._free(m),E._free(_),E._free(o),E._free(f),E._free(d),E._free(g),[new Float32Array(A),new Float32Array(F),new Float32Array(u),new Float32Array(s)];console.error("Unsupported model name:",modelName)}onmessage=function(E){if("LOAD_WASM"===E.data.msg)modelName=E.data.model,scriptName=E.data.scriptName,modelBuffers=E.data.modelBuffers,loadWASMModule(scriptName);else if("PROCESS_AUDIO"===E.data.msg||"PROCESS_AUDIO_BATCH"===E.data.msg){let t=E.data.leftChannel,o=E.data.rightChannel;wasmModule.then(r=>{console.log("Loading wasm module for model "+modelName);var e=modelBuffers.map(e=>new Uint8Array(e));let a=e.map(e=>r._malloc(e.byteLength));e.forEach((e,l)=>r.HEAPU8.set(e,a[l])),"demucs-free-4s"===modelName||"demucs-free-6s"===modelName||"demucs-free-v3"===modelName||"demucs-karaoke"===modelName?r._modelInit(a[0],e[0].byteLength):"demucs-pro-ft"===modelName||"demucs-pro-deluxe"===modelName?r._modelInit(a[0],e[0].byteLength,a[1],e[1].byteLength,a[2],e[2].byteLength,a[3],e[3].byteLength):"demucs-pro-cust"===modelName?r._modelInit(a[0],e[0].byteLength,a[1],e[1].byteLength,a[2],e[2].byteLength,null,0):console.error("Unsupported model name:",modelName),a.forEach(e=>r._free(e)),postMessage({msg:"WASM_READY"});let l;"PROCESS_AUDIO"===E.data.msg?l=processAudio(t,o,r,!1):"PROCESS_AUDIO_BATCH"===E.data.msg&&(l=processAudio(t,o,r,!0));e=l.map(e=>e.buffer);postMessage({msg:"PROCESS_AUDIO"===E.data.msg?"PROCESSING_DONE":"PROCESSING_DONE_BATCH",waveforms:l,originalLength:E.data.originalLength,filename:"PROCESS_AUDIO"===E.data.msg?"":E.data.filename},e)})}};