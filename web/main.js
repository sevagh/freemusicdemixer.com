let hamburgerMenu=document.getElementById("hamburger-menu"),navbarLinks=document.querySelector(".navbar-links"),modal=(hamburgerMenu.addEventListener("click",()=>{navbarLinks.classList.toggle("active")}),document.getElementById("login-modal")),loginBtn=document.getElementById("login-btn"),closeModal=document.querySelector(".close"),emailInput=document.getElementById("billing-email"),responseMessage=document.getElementById("response-message"),tierLogos={0:"/assets/images/logo_free.webp",2:"/assets/images/logo_pro.webp"},tierNames={0:"Free",2:"Pro"},themeToggle=(loginBtn.addEventListener("click",()=>{modal.classList.add("show")}),closeModal.addEventListener("click",()=>{modal.classList.remove("show")}),window.addEventListener("click",e=>{e.target===modal&&modal.classList.remove("show")}),document.getElementById("activation-form").addEventListener("submit",function(e){e.preventDefault(),activateProContent(emailInput.value)}),document.getElementById("theme-toggle")),themeIcon=document.getElementById("theme-icon"),demixImg=document.getElementById("music-demix-img"),amtImg=document.getElementById("amt-img"),themeResetButton=document.getElementById("theme-reset");function changeGiscusTheme(e){var t;e={setConfig:{theme:e}},(t=document.querySelector("iframe.giscus-frame"))&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function applyTheme(e){document.documentElement.classList.remove("theme-dark","theme-light"),"dark"===e?(document.documentElement.classList.add("theme-dark"),themeIcon.className="fa fa-sun",themeToggle.setAttribute("aria-label","Switch to light mode"),demixImg&&amtImg&&(demixImg.src="/assets/images/music-demix-dark.webp",amtImg.src="/assets/images/midi-amt-dark.webp")):(document.documentElement.classList.add("theme-light"),themeIcon.className="fa fa-moon",themeToggle.setAttribute("aria-label","Switch to dark mode"),demixImg&&amtImg&&(demixImg.src="/assets/images/music-demix.webp",amtImg.src="/assets/images/midi-amt.webp")),document.getElementById("giscus-script")&&changeGiscusTheme(e)}function loadTheme(){var e=localStorage.getItem("theme");applyTheme(e||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"))}function popupLogic(){let t=document.getElementById("popup-banner"),n=document.getElementById("popup-overlay");var o=document.getElementById("close-popup");if(t&&n){let e=!sessionStorage.getItem("popupDismissed");function s(){t&&t.classList.remove("popup-banner-shown"),n&&n.classList.remove("popup-overlay-shown"),e=!1,sessionStorage.setItem("popupDismissed","true")}t&&n&&window.addEventListener("scroll",()=>{30<window.scrollY/(document.body.offsetHeight-window.innerHeight)*100&&e&&(t.classList.add("popup-banner-shown"),n.classList.add("popup-overlay-shown"))}),o&&o.addEventListener("click",s),n&&n.addEventListener("click",s)}}function displayLoginSpinner(){console.log("Displaying spinner"),document.getElementById("login-overlay").style.display="flex",document.getElementById("login-spinner").style.display="flex"}function removeLoginSpinner(){document.getElementById("login-overlay").style.display="none",document.getElementById("login-spinner").style.display="none"}function activateProContent(t){displayLoginSpinner(),localStorage.setItem("billingEmail",t),trackProductEvent("Content Activated",{email:t}),fetch("https://freemusicdemixer.com/getprocontent?email="+encodeURIComponent(t)).then(e=>{if(e.ok)return e.json();throw removeLoginSpinner(),document.getElementById("response-message").innerHTML='Login failed. If this is a mistake, <a href="/support" target="_blank" alt="contact-link">contact us</a>.',new Error("Failed to fetch content")}).then(e=>{e=e.tier;console.log("User Tier: "+e),trackProductEvent("Tier Activated",{email:t,userTier:e}),sessionStorage.setItem("loggedIn","true"),sessionStorage.setItem("userTier",e),activateTierUI(e)}).catch(e=>console.error("Error fetching user tier:",e))}function activateTierUI(e){removeLoginSpinner();var t=document.querySelector("#logo-display img"),n=document.querySelector("#logo-display small"),n=(t&&n&&(t.src=tierLogos[e],t.alt=`freemusicdemixer-${tierNames[e].toLowerCase()}-logo`,n.textContent=tierNames[e]+" tier ",n.appendChild(t)),2===e&&(document.getElementById("response-message").innerHTML=tierNames[e]+' activated. <a class="wizard-link" href="https://billing.stripe.com/p/login/eVacPX8pKexG5tm8ww">Manage your subscription</a>.'),new CustomEvent("loginSuccess"));window.dispatchEvent(n)}themeResetButton.addEventListener("click",()=>{localStorage.removeItem("theme"),loadTheme()}),themeToggle.addEventListener("click",()=>{var e="dark"==(document.documentElement.classList.contains("theme-dark")?"dark":"light")?"light":"dark";localStorage.setItem("theme",e),applyTheme(e)}),document.addEventListener("DOMContentLoaded",function(){loadTheme();var e=localStorage.getItem("billingEmail"),e=(e&&(emailInput.value=e,responseMessage.textContent=""),"true"===sessionStorage.getItem("loggedIn"));let t=0;activateTierUI(t=!e||-1!==(t=parseInt(sessionStorage.getItem("userTier")))&&!isNaN(t)?t:0),popupLogic()});